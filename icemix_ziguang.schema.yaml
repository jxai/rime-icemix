# Rime schema
# encoding: utf-8

# 混拼方案，基于 double_pinyin_ziguang.schema.yaml 定制。
# 支持混合输入 紫光双拼 + 雾凇拼音 + 简拼，参考 https://dvel.me/posts/rime-full-pinyin-double-pinyin-mixed-input/
# 支持带音调的拼音反查，使用 https://github.com/amzxyz/RIME-LMDG 字典
# 双拼键位映射复制自 https://github.com/rime/rime-double-pinyin
# 双拼之间主要就是 speller/algebra 和 translator/preedit_format 这里有区别
#
# 全拼的自定义文本和双拼有些冲突，改成了 custom_phrase_double ，需要创建 custom_phrase_double.txt 文件
#
# 目前配置中有个别功能仍然是全拼拼写，不能自动适配，所以需要手动修改一下：
# - 英文中部分符号的派生规则：在英文方案文件 melt_eng.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# - 部件拆字的拼写规则：在部件拆字方案 radical_pinyin.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# 打个补丁一劳永逸，补丁写法参考 [常见问题](https://github.com/iDvel/rime-ice/issues/133) 或 others/双拼补丁示例/ 文件夹

# 方案说明
schema:
  schema_id: icemix_ziguang
  name: 凇紫混拼
  version: '1'
  author:
    - jxai
    - Dvel
  description: |
    混拼方案，支持混合输入 紫光双拼 + 雾凇拼音 + 简拼
    https://github.com/jxai/rime-icemix
  dependencies:
    __include: icemix_common:/schema/dependencies

switches:
  __include: icemix_common:/switches

engine:
  __include: icemix_common:/engine

date_translator:
  __include: icemix_common:/date_translator

lunar:
  __include: icemix_common:/lunar

uuid:
  __include: icemix_common:/uuid

reduce_english_filter:
  __include: icemix_common:/reduce_english_filter

pin_cand_filter:
  __include: icemix_common:/pin_cand_filter

long_word_filter:
  __include: icemix_common:/long_word_filter

# 主翻译器，拼音
translator:
  __include: icemix_common:/translator
  prism: icemix_ziguang # 多方案共用一个词库时，为避免冲突，需要用 prism 指定一个名字。

melt_eng:
  __include: icemix_common:/melt_eng

# 中英混合词汇
cn_en:
  __include: icemix_common:/cn_en
  user_dict: en_dicts/cn_en_ziguang

custom_phrase:
  __include: icemix_common:/custom_phrase

emoji:
  __include: icemix_common:/emoji

traditionalize:
  __include: icemix_common:/traditionalize

punctuator:
  __include: icemix_common:/punctuator

radical_lookup:
  __include: icemix_common:/radical_lookup

radical_reverse_lookup:
  __include: icemix_common:/radical_reverse_lookup

# 紫光双拼用 ; 键映射 ing，需要在反查模式中也支持 ;
recognizer:
  __include: icemix_common:/recognizer
  patterns:
    punct: '^V([0-9]|10|[A-Za-z]+)$'
    radical_lookup: '^uU[a-z;]+$' # 响应部件拆字的反查，触发前缀与 radical_lookup/prefix 匹配
    unicode: '^U[a-f0-9]+'
    number: '^R[0-9]+[.]?[0-9]*'
    calculator: '^cC.+'
    gregorian_to_lunar: '^N[0-9]{1,8}'

key_binder:
  __include: icemix_common:/key_binder

editor:
  __include: icemix_common:/editor

# 拼写设定
speller:
  # 如果不想让什么标点直接上屏，可以加在 alphabet，或者编辑标点符号为两个及以上的映射
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA;`
  # initials 定义仅作为始码的按键，排除 ` ; 让单个的 ` ; 可以直接上屏
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '" # 第一位<空格>是拼音之间的分隔符；第二位<'>表示可以手动输入单引号来分割拼音。
  algebra:
    - erase/^xx$/
    - derive/^([jqxy])u$/$1v/
    - derive/^([aoe].*)$/Ⓞ$1/ # 添上固定的零聲母o，先標記爲大寫O
    - derive/en$/Ⓦ/
    - derive/eng$/Ⓣ/
    - derive/in$|uai$/Ⓨ/
    - derive/^zh/Ⓤ/
    - derive/^sh/Ⓘ/
    - derive/uo$/Ⓞ/
    - derive/ai$/Ⓟ/
    - derive/^ch/Ⓐ/
    - derive/[iu]ang$/Ⓖ/
    - derive/ang$/Ⓢ/ # ang should be placed after iang/uang
    - derive/ie$/Ⓓ/
    - derive/ian$/Ⓕ/
    - derive/(.)i?ong$/$1Ⓗ/
    - derive/er$|iu$/Ⓙ/
    - derive/ei$/Ⓚ/
    - derive/uan$/Ⓛ/
    - derive/ing$/;/
    - derive/ou$/Ⓩ/
    - derive/[iu]a$/Ⓧ/
    - derive/iao$/Ⓑ/
    - derive/ue$|ui$|ve$/Ⓝ/
    - derive/un$/Ⓜ/
    - derive/ao$/Ⓠ/ # ao should be placed after iao
    - derive/an$/Ⓡ/ # an should be placed after uan/ian
    - xlit/ⓌⓉⓎⓊⒾⓄⓅⒶⒼⓈⒹⒻⒽⒿⓀⓁⓏⓍⒷⓃⓂⓆⓇ/wtyuiopagsdfhjklzxbnmqr/
    # 首字母简拼，卷舌音字输入z/zh/u､c/ch/a､s/sh/i皆可，开启后会导致 3 个字母时 kj'x 变成 k'jx 的问题
    - abbrev/^(.).+$/$1/
