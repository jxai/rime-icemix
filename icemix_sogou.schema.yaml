# Rime schema
# encoding: utf-8

# 混拼方案，基于 double_pinyin_sogou.schema.yaml 定制。
# 支持混合输入 搜狗双拼 + 雾凇拼音 + 简拼，参考 https://dvel.me/posts/rime-full-pinyin-double-pinyin-mixed-input/
# 支持带音调的拼音反查，使用 https://github.com/amzxyz/RIME-LMDG 字典
# 双拼键位映射复制自 https://github.com/rime/rime-double-pinyin
# 双拼之间主要就是 speller/algebra 和 translator/preedit_format 这里有区别
#
# 全拼的自定义文本和双拼有些冲突，改成了 custom_phrase_double ，需要创建 custom_phrase_double.txt 文件
#
# 目前配置中有个别功能仍然是全拼拼写，不能自动适配，所以需要手动修改一下：
# - 英文中部分符号的派生规则：在英文方案文件 melt_eng.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# - 部件拆字的拼写规则：在部件拆字方案 radical_pinyin.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# 打个补丁一劳永逸，补丁写法参考 [常见问题](https://github.com/iDvel/rime-ice/issues/133) 或 others/双拼补丁示例/ 文件夹

# 方案说明
schema:
  schema_id: icemix_sogou
  name: 凇狗混拼
  version: '1'
  author:
    - jxai
    - Dvel
  description: |
    混拼方案，支持混合输入 搜狗双拼 + 雾凇拼音 + 简拼
    https://github.com/jxai/rime-icemix
  dependencies:
    __include: icemix_common:/schema/dependencies

switches:
  __include: icemix_common:/switches

# 搜狗双拼的 cn_en 和 melt_eng 翻译器顺序与其他方案不同
engine:
  __include: icemix_common:/engine
  translators:
    - punct_translator
    - script_translator
    - lua_translator@*date_translator # 时间、日期、星期
    - lua_translator@*lunar # 农历
    - lua_translator@*uuid # UUID
    - table_translator@custom_phrase # 自定义短语 custom_phrase_double.txt
    - table_translator@cn_en # 中英混合词汇
    - table_translator@melt_eng # 英文输入
    - table_translator@radical_lookup # 部件拆字反查
    - lua_translator@*unicode # Unicode
    - lua_translator@*number_translator # 数字、金额大写
    - lua_translator@*calc_translator # 计算器
    - lua_translator@*force_gc # 暴力 GC

date_translator:
  __include: icemix_common:/date_translator

lunar:
  __include: icemix_common:/lunar

uuid:
  __include: icemix_common:/uuid

reduce_english_filter:
  __include: icemix_common:/reduce_english_filter

pin_cand_filter:
  __include: icemix_common:/pin_cand_filter

long_word_filter:
  __include: icemix_common:/long_word_filter

# 主翻译器，拼音
translator:
  __include: icemix_common:/translator
  prism: icemix_sogou # 多方案共用一个词库时，为避免冲突，需要用 prism 指定一个名字。

melt_eng:
  __include: icemix_common:/melt_eng

# 中英混合词汇
cn_en:
  __include: icemix_common:/cn_en
  user_dict: en_dicts/cn_en_sogou

custom_phrase:
  __include: icemix_common:/custom_phrase

emoji:
  __include: icemix_common:/emoji

traditionalize:
  __include: icemix_common:/traditionalize

punctuator:
  __include: icemix_common:/punctuator

radical_lookup:
  __include: icemix_common:/radical_lookup

radical_reverse_lookup:
  __include: icemix_common:/radical_reverse_lookup

# 搜狗双拼用 ; 键映射 ing，需要在反查模式中也支持 ;
recognizer:
  __include: icemix_common:/recognizer
  patterns:
    punct: '^V([0-9]|10|[A-Za-z]+)$'
    radical_lookup: '^uU[a-z;]+$' # 响应部件拆字的反查，触发前缀与 radical_lookup/prefix 匹配
    unicode: '^U[a-f0-9]+'
    number: '^R[0-9]+[.]?[0-9]*'
    calculator: '^cC.+'
    gregorian_to_lunar: '^N[0-9]{1,8}'

key_binder:
  __include: icemix_common:/key_binder

editor:
  __include: icemix_common:/editor

# 拼写设定
speller:
  # 如果不想让什么标点直接上屏，可以加在 alphabet，或者编辑标点符号为两个及以上的映射
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA;`
  # initials 定义仅作为始码的按键，排除 ` ; 让单个的 ` ; 可以直接上屏
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '" # 第一位<空格>是拼音之间的分隔符；第二位<'>表示可以手动输入单引号来分割拼音。
  algebra:
    - erase/^xx$/
    - derive/^([jqxy])u$/$1v/
    - derive/^([aoe].*)$/o$1/
    - derive/^([ae])(.*)$/$1$1$2/
    - derive/iu$/Ⓠ/
    - derive/[iu]a$/Ⓦ/
    - derive/er$|[uv]an$/Ⓡ/
    - derive/[uv]e$/Ⓣ/
    - derive/v$|uai$/Ⓨ/
    - derive/^sh/Ⓤ/
    - derive/^ch/Ⓘ/
    - derive/^zh/Ⓥ/
    - derive/uo$/Ⓞ/
    - derive/[uv]n$/Ⓟ/
    - derive/(.)i?ong$/$1Ⓢ/
    - derive/[iu]ang$/Ⓓ/
    - derive/(.)en$/$1Ⓕ/
    - derive/(.)eng$/$1Ⓖ/
    - derive/(.)ang$/$1Ⓗ/
    - derive/ian$/Ⓜ/
    - derive/(.)an$/$1Ⓙ/
    - derive/iao$/Ⓒ/
    - derive/(.)ao$/$1Ⓚ/
    - derive/(.)ai$/$1Ⓛ/
    - derive/(.)ei$/$1Ⓩ/
    - derive/ie$/Ⓧ/
    - derive/ui$/Ⓥ/
    - derive/(.)ou$/$1Ⓑ/
    - derive/in$/Ⓝ/
    - derive/ing$/;/
    - xlit/ⓆⓌⓇⓉⓎⓊⒾⓄⓅⓈⒹⒻⒼⒽⓂⒿⒸⓀⓁⓏⓍⓋⒷⓃ/qwrtyuiopsdfghmjcklzxvbn/
    # 首字母简拼，卷舌音字输入z/zh/v､c/ch/i､s/sh/u皆可，开启后会导致 3 个字母时 kj'x 变成 k'jx 的问题
    - abbrev/^(.).+$/$1/
